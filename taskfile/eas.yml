version: "3"

tasks:
  trigger:
    desc: "Trigger an attestation request"
    vars:
      TRIGGER_ADDRESS: "{{.TRIGGER_ADDRESS}}"
      SCHEMA_UID: "{{.SCHEMA_UID}}"
      RECIPIENT: "{{.RECIPIENT}}"
      MESSAGE: '{{.MESSAGE | default "Attestation via WAVS"}}'
      RPC_URL:
        sh: task get-rpc
    preconditions:
      - test -n "{{.TRIGGER_ADDRESS}}"
      - test -n "{{.SCHEMA_UID}}"
      - test -n "{{.RECIPIENT}}"
    cmds:
      - |
        forge script script/EASAttestTrigger.s.sol:EASAttestTriggerScript \
          --sig "triggerRawAttestation(string,string,string,string)" \
          "{{.TRIGGER_ADDRESS}}" \
          "{{.SCHEMA_UID}}" \
          "{{.RECIPIENT}}" \
          "{{.MESSAGE}}" \
          --rpc-url {{.RPC_URL}} --broadcast

  query:
    desc: "Query attestations"
    vars:
      INDEXER_ADDRESS: "{{.INDEXER_ADDRESS}}"
      EAS_ADDRESS: "{{.EAS_ADDRESS}}"
      SCHEMA_UID: "{{.SCHEMA_UID}}"
      RECIPIENT: "{{.RECIPIENT}}"
      LIMIT: '{{.LIMIT | default "10"}}'
      RPC_URL:
        sh: task get-rpc
    preconditions:
      - test -n "{{.INDEXER_ADDRESS}}"
      - test -n "{{.EAS_ADDRESS}}"
      - test -n "{{.SCHEMA_UID}}"
      - test -n "{{.RECIPIENT}}"
    cmds:
      - |
        forge script script/EASAttestTrigger.s.sol:EASAttestTriggerScript \
          --sig "queryAttestations(string,string,string,string,uint256)" \
          "{{.INDEXER_ADDRESS}}" \
          "{{.EAS_ADDRESS}}" \
          "{{.SCHEMA_UID}}" \
          "{{.RECIPIENT}}" \
          {{.LIMIT}} \
          --rpc-url {{.RPC_URL}}
